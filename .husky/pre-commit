#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-commit checks..."

# Run PHP tests with Pest (parallel for speed)
echo "ğŸ§ª Running PHP tests with Pest..."
if ! ./vendor/bin/sail artisan test --parallel --stop-on-failure; then
    echo "âŒ PHP tests failed! Commit aborted."
    exit 1
fi

# Run JavaScript tests with Vitest for changed files
echo "ğŸ§ª Running JavaScript tests..."
if ! npm run test:js; then
    echo "âŒ JavaScript tests failed! Commit aborted."
    exit 1
fi

# Run lint-staged for auto-fixing and testing staged files
echo "âœ¨ Running lint-staged..."
if ! npx lint-staged; then
    echo "âŒ Lint-staged checks failed! Commit aborted."
    exit 1
fi

echo "âœ… All pre-commit checks passed!"